-- üì¶ CONFIG
_G.WebhookURL = "https://discord.com/api/webhooks/..." -- ‡πÉ‡∏™‡πà webhook ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì
_G.Enabled = true
_G.Layout = {
    ["ROOT/SeedStock/Stocks"] = { title = "üå± SEEDS STOCK", color = 65280 },
    ["ROOT/GearStock/Stocks"] = { title = "üõ†Ô∏è GEAR STOCK", color = 16753920 },
    ["ROOT/PetEggStock/Stocks"] = { title = "ü•ö EGG STOCK", color = 16776960 },
    ["ROOT/CosmeticStock/ItemStocks"] = { title = "üé® COSMETIC STOCK", color = 16737792 }
}

-- üì° SERVICES
local Players = game:GetService("Players")
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local HttpService = game:GetService("HttpService")
local LocalPlayer = Players.LocalPlayer
local DataStream = ReplicatedStorage:WaitForChild("GameEvents"):WaitForChild("DataStream")

-- üåê HTTP fallback
local requestFunc = http_request or request or syn and syn.request
if not requestFunc then
    warn("[‚ùå] HTTP request ‡πÑ‡∏°‡πà‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö‡∏ö‡∏ô executor ‡∏ô‡∏µ‡πâ")
end

-- üîÑ ‡πÅ‡∏õ‡∏•‡∏á stock ‡πÄ‡∏õ‡πá‡∏ô string
local function GetStockString(stock)
    local s = ""
    for name, data in pairs(stock) do
        local display = data.EggName or name
        s ..= (`{display} x{data.Stock}\n`)
    end
    return s
end

-- üì§ ‡∏™‡πà‡∏á webhook ‡πÅ‡∏¢‡∏Å embed ‡∏ï‡πà‡∏≠‡∏´‡∏°‡∏ß‡∏î
local function SendSingleEmbed(title, bodyText, color)
    if not _G.Enabled or not requestFunc then
        print("[‚ö†Ô∏è] Webhook ‡∏™‡πà‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ")
        return
    end
    if bodyText == "" then
        print("[‚ÑπÔ∏è] Stock ‡∏ß‡πà‡∏≤‡∏á ‡πÑ‡∏°‡πà‡∏™‡πà‡∏á:", title)
        return
    end

    print("[üì§] ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏™‡πà‡∏á:", title)

    local body = {
        embeds = {{
            title = title,
            description = bodyText,
            color = color,
            timestamp = DateTime.now():ToIsoDate(),
            footer = { text = "Grow a Garden Stock Bot (Mobile)" }
        }}
    }

    requestFunc({
        Url = _G.WebhookURL,
        Method = "POST",
        Headers = {["Content-Type"] = "application/json"},
        Body = HttpService:JSONEncode(body)
    })
end

-- üß© ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤ packet ‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏à‡∏≤‡∏Å data
local function GetPacket(data, key)
    for _, packet in ipairs(data) do
        if packet[1] == key then
            return packet[2]
        end
    end
end

-- üì• ‡∏£‡∏±‡∏ö event ‡πÅ‡∏•‡∏∞‡∏™‡πà‡∏á‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô
DataStream.OnClientEvent:Connect(function(eventType, profile, data)
    print("[üì°] ‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö Event:", eventType, profile)

    if eventType ~= "UpdateData" then return end
    if not profile:find(LocalPlayer.Name) then
        print("[‚ö†Ô∏è] Profile ‡πÑ‡∏°‡πà‡∏ï‡∏£‡∏á‡∏Å‡∏±‡∏ö‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô:", profile)
        return
    end

    for path, layout in pairs(_G.Layout) do
        local stockData = GetPacket(data, path)
        if stockData then
            local stockStr = GetStockString(stockData)
            SendSingleEmbed(layout.title, stockStr, layout.color)
        else
            print("[‚ùå] ‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•:", path)
        end
    end
end)

print("[‚úÖ] Stock Checker ‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡πÅ‡∏•‡πâ‡∏ß (‡πÑ‡∏°‡πà‡∏°‡∏µ Event Stock)")
